/*
23. Desarrolle el/los elementos de base de datos necesarios para que ante una venta
automáticamante se controle que en una misma factura no puedan venderse más
de dos productos con composición. Si esto ocurre debera rechazarse la factura.*/use GD2015C1gocreate trigger ej23on facturafor insertasbegin	declare cursor_factura cursor for	select count(*), fact_sucursal+fact_tipo+fact_numero	from inserted		join item_factura on item_sucursal+item_tipo+item_numero = fact_sucursal+fact_tipo+fact_numero	where item_producto in (select comp_producto from composicion)	group by fact_sucursal+fact_tipo+fact_numero	declare @cantidad_compuestos int	declare @fact_pk char(13)	open cursor_factura		fetch next from cursor_factura into @cantidad_compuestos, @fact_pk		while @@FETCH_STATUS = 0		begin			if @cantidad_compuestos > 2			begin				delete from factura				where fact_sucursal+fact_tipo+fact_numero = @fact_pk				delete from item_factura				where item_sucursal+item_tipo+item_numero = @fact_pk			end			fetch next from cursor_factura into @cantidad_compuestos, @fact_pk		end	close cursor_factura	deallocate cursor_facturaend